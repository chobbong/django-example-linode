{% extends 'base.html' %}

{% block content %}
<form method="get" action="{% url 'search' %}">
    <input type="text" name="query" placeholder="단지명을 입력하세요...">
    <input type="submit" value="검색">
</form>

<!-- Google Maps Container -->
<div id="map" style="height: 500px;"></div>

<script>
// Your modified JavaScript for Google Maps
let map;

function initMap() {
  const locations = {{ locations|safe }}; // Get data from Django
  const center = locations.length > 0 ? locations[0] : { lat: 37.5665, lng: 126.9780 }; // Seoul as default

  map = new google.maps.Map(document.getElementById("map"), {
    zoom: 12,
    center: center,
  });

  locations.forEach(location => {
     const marker = new google.maps.Marker({
       map: map,
       position: { lat: location.lat, lng: location.lng },
       title: location.단지명,
     });
 
     marker.addListener('click', function() {
       const contentString = `
         <h3>${location.단지명}</h3>
         <p><strong>시군구:</strong> ${location.시군구}</p>
         <p><strong>계약연월:</strong> ${location.계약연월}</p>
         <p><strong>전용면적:</strong> ${location.전용면적} ㎡</p>
         <p><strong>매매대금 평균:</strong> ${location.매매대금_평균} 만원</p>
         <p><strong>전세 평균:</strong> ${location.전세_평균} 만원</p>
         <p><strong>전세가율 90%:</strong> ${location.전세가율_90}%</p>
         <p><strong>전세가율 80%:</strong> ${location.전세가율_80}%</p>
         <p><strong>전세가율 70%:</strong> ${location.전세가율_70}%</p>
         <p><strong>전세가율 60%:</strong> ${location.전세가율_60}%</p>
       `;
 
       const infoWindow = new google.maps.InfoWindow({
         content: contentString
       });
       infoWindow.open(map, marker);
     });
   });
 }
 
 initMap();
 </script>
 
 <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB5GPHVbAcjS8yiINFJ0e9KUVUPFwV_2LY&callback=initMap"></script>
 {% endblock %}
